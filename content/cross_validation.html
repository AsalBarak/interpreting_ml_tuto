<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. Cross-validation: some gotchas &#8212; Tutorial</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Underfit vs overfit: do I need more data, or more complex models?" href="underfit_vs_overfit.html" />
    <link rel="prev" title="1. Metrics to judge the sucess of a model" href="metrics.html" />
   
    <link rel="stylesheet"
	  href="https://unpkg.com/purecss@1.0.0/build/base-min.css">

<script type="text/javascript">
$(function () {
    // Highlight the table of content as we scroll
    sections = {},
    i        = 0,
    url	 = document.URL.replace(/#.*$/, ""),
    current_section = 0;

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();

	// Highlight the current section
	$('a.internal').parent().removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().parent().parent().addClass('active');
    });

});
</script>


  </head>
  <body role="document">
   <!-- Use the header to add javascript -->
    

    <script type="text/javascript">
    // Function to collapse the tip divs
    function collapse_tip_div(obj){
	// Update the representation on the tip div based on whether it
	// has the 'collapsed' css class or not: we only want to
	// collapse divs that are not already collapsed
	if($(obj).hasClass("collapsed")) {
	} else {
	    $(obj).find("p.summary").remove();
	    var content = $(obj).text();
	    var html = $(obj).html();

	    if(content.length > 40) {
		if ($.browser.msie) {
		    // We start at '3' to avoid 'tip', as IE
		    // does not count whitespace
		    var content = content.substr(3, 50);
		} else {
		    // We start at '5' to avoid 'tip '
		    var content = content.substr(5, 50);
		}
	    }
	    $(obj).html('<p class="summary"><img src="../_static/plus.png">' + content + '...</p>' + html);
	}
    }
    </script>

    <script type="text/javascript">
    $(function () {
	$(".tip")
	    .click(function(event){
		$(this).toggleClass("collapsed");
		// Change state of the global button
		$('div.related li.transparent').removeClass('transparent')
		$(this).find("p.summary").remove();
		if($(this).hasClass("collapsed")) {
		    var content = $(this).text();
		    var html = $(this).html();

		    if(content.length > 40) {
			if ($.browser.msie) {
			    // We start at '3' to avoid 'tip', as IE
			    // does not count whitespace
			    var content = content.substr(3, 50);
			} else {
			    // We start at '5' to avoid 'tip '
			    var content = content.substr(5, 50);
			}
		    }
		    $(this).html('<p class="summary"><img src="../_static/plus.png">' + content + '...</p>' + html);
		}
		if (event.target.tagName.toLowerCase() != "a") {
                   return true; //Makes links clickable
		}
	});
    });
    </script>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="underfit_vs_overfit.html" title="3. Underfit vs overfit: do I need more data, or more complex models?"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="metrics.html" title="1. Metrics to judge the sucess of a model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Tutorial</a> &#187;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="../_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-content-cross-validation-py"><span class="std std-ref">here</span></a> to download the full example code or run this example in your browser via Binder</p>
</div>
<div class="sphx-glr-example-title section" id="cross-validation-some-gotchas">
<span id="sphx-glr-content-cross-validation-py"></span><h1>2. Cross-validation: some gotchas<a class="headerlink" href="#cross-validation-some-gotchas" title="Permalink to this headline">¶</a></h1>
<p>Cross-validation is the ubiquitous test of a machine learning model. Yet
many things can go wrong.</p>
<div class="section" id="the-uncertainty-of-measured-accuracy">
<h2>2.1. The uncertainty of measured accuracy<a class="headerlink" href="#the-uncertainty-of-measured-accuracy" title="Permalink to this headline">¶</a></h2>
<p>The first thing to have in mind is that the results of a
cross-validation are noisy estimate of the real prediction accuracy</p>
<p>Let us create a simple artificial data</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">discriminant_analysis</span>
<div class="newline"></div><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<div class="newline"></div><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_blobs</span><span class="p">(</span><span class="n">centers</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
<div class="newline"></div><span class="n">classifier</span> <span class="o">=</span> <span class="n">discriminant_analysis</span><span class="o">.</span><span class="n">LinearDiscriminantAnalysis</span><span class="p">()</span>
<div class="newline"></div></pre></div>
</div>
<p>One cross-validation gives spread out measures</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<div class="newline"></div><span class="k">print</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
<div class="newline"></div></pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">0.64705882</span>  <span class="mf">0.67647059</span>  <span class="mf">0.84375</span>   <span class="p">]</span>
<div class="newline"></div></pre></div>
</div>
<p>What if we try different random shuffles of the data?</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">utils</span>
<div class="newline"></div><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<div class="newline"></div>    <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<div class="newline"></div>    <span class="k">print</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
<div class="newline"></div></pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">0.76470588</span>  <span class="mf">0.70588235</span>  <span class="mf">0.65625</span>   <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.70588235</span>  <span class="mf">0.67647059</span>  <span class="mf">0.75</span>      <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.73529412</span>  <span class="mf">0.64705882</span>  <span class="mf">0.71875</span>   <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.70588235</span>  <span class="mf">0.58823529</span>  <span class="mf">0.8125</span>    <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.67647059</span>  <span class="mf">0.73529412</span>  <span class="mf">0.71875</span>   <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.70588235</span>  <span class="mf">0.64705882</span>  <span class="mf">0.75</span>      <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.67647059</span>  <span class="mf">0.67647059</span>  <span class="mf">0.71875</span>   <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.70588235</span>  <span class="mf">0.61764706</span>  <span class="mf">0.8125</span>    <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.76470588</span>  <span class="mf">0.76470588</span>  <span class="mf">0.59375</span>   <span class="p">]</span>
<div class="newline"></div><span class="p">[</span> <span class="mf">0.76470588</span>  <span class="mf">0.61764706</span>  <span class="mf">0.625</span>     <span class="p">]</span>
<div class="newline"></div></pre></div>
</div>
<p>This should not be surprising: if the lassification rate is p, the
observed distribution of correct classifications on a set of size
follows a binomial distribution</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<div class="newline"></div><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<div class="newline"></div><span class="n">distrib</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p>We can plot it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<div class="newline"></div><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<div class="newline"></div><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">distrib</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../_images/sphx_glr_cross_validation_001.png" class="sphx-glr-single-img" src="../_images/sphx_glr_cross_validation_001.png" />
<p>It is wide, because there are not that many samples to mesure the error
upon: iris is a small dataset</p>
<p>We can look at the interval in which 95% of the observed accuracy lies
for different sample sizes</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">]:</span>
<div class="newline"></div>    <span class="n">distrib</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">)</span>
<div class="newline"></div>    <span class="n">interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">distrib</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="o">.</span><span class="mo">025</span><span class="p">)</span> <span class="o">-</span> <span class="n">distrib</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="o">.</span><span class="mi">975</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
<div class="newline"></div>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Size: {0: 7}  | interval: {1}%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">interval</span><span class="p">))</span>
<div class="newline"></div></pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Size</span><span class="p">:</span>     <span class="mi">100</span>  <span class="o">|</span> <span class="n">interval</span><span class="p">:</span> <span class="mf">18.0</span><span class="o">%</span>
<div class="newline"></div><span class="n">Size</span><span class="p">:</span>    <span class="mi">1000</span>  <span class="o">|</span> <span class="n">interval</span><span class="p">:</span> <span class="mf">5.7</span><span class="o">%</span>
<div class="newline"></div><span class="n">Size</span><span class="p">:</span>   <span class="mi">10000</span>  <span class="o">|</span> <span class="n">interval</span><span class="p">:</span> <span class="mf">1.8</span><span class="o">%</span>
<div class="newline"></div><span class="n">Size</span><span class="p">:</span>  <span class="mi">100000</span>  <span class="o">|</span> <span class="n">interval</span><span class="p">:</span> <span class="mf">0.568</span><span class="o">%</span>
<div class="newline"></div></pre></div>
</div>
<p>At 100 000 samples, 5% of the observed classification accuracy still
fall more than .5% away of the true rate</p>
<p><strong>Keep in mind that cross-val is a noisy measure</strong></p>
<p>Importantly, the variance across folds is not a good measure of this
error, as the different data folds are not independent. For instance,
doing many random splits will can reduce the variance arbitrarily, but
does not provide actually new data points</p>
</div>
<div class="section" id="confounding-effects-and-non-independence">
<h2>2.2. Confounding effects and non independence<a class="headerlink" href="#confounding-effects-and-non-independence" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="permutations-to-measure-chance">
<h2>2.3. Permutations to measure chance<a class="headerlink" href="#permutations-to-measure-chance" title="Permalink to this headline">¶</a></h2>
<p><strong>Total running time of the script:</strong> ( 0 minutes  0.322 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-content-cross-validation-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/gaelvaroquaux/interpreting_ml_tuto/master?filepath=_downloads/cross_validation.ipynb"><img alt="https://static.mybinder.org/badge.svg" src="https://static.mybinder.org/badge.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/cross_validation.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">cross_validation.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/cross_validation.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">cross_validation.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
<p><div style="clear: both"></div></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
	<div class="sidebartoc">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. Cross-validation: some gotchas</a><ul>
<li><a class="reference internal" href="#the-uncertainty-of-measured-accuracy">2.1. The uncertainty of measured accuracy</a></li>
<li><a class="reference internal" href="#confounding-effects-and-non-independence">2.2. Confounding effects and non independence</a></li>
<li><a class="reference internal" href="#permutations-to-measure-chance">2.3. Permutations to measure chance</a></li>
</ul>
</li>
</ul>
</div>



    <div class="script_container">
    <script>
    (function() {
	var cx = '004523248466141510607:hgv2yimrahw';
	var gcse = document.createElement('script');
	gcse.type = 'text/javascript';
	gcse.async = true;
	gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
	    '//cse.google.com/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <gcse:search></gcse:search>
    </div>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="underfit_vs_overfit.html" title="3. Underfit vs overfit: do I need more data, or more complex models?"
             >next</a></li>
        <li class="right" >
          <a href="metrics.html" title="1. Metrics to judge the sucess of a model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Tutorial</a> &#187;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="../_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>

      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.
    </div>
  </body>
</html>